<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Heart Map | An Interactive Love Letter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Dancing+Script:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --cream: #FDF8F3;
      --sage: #7D8B6F;
      --deep-sage: #5C6B4F;
      --blush: #E8DDD4;
      --moss: #4A5D3E;
      --rose-gold: #B76E79;
      --dusty-rose: #C9A9A6;
      --soft-pink: #E8B4B8;
      --pale-pink: #F5C6D6;
      --deep-pink: #9E4A5A;
    }
    
    body {
      background: var(--cream);
      font-family: 'Inter', sans-serif;
      color: #2C3E2F;
      overflow-x: hidden;
      margin: 0;
      padding: 0;
    }
    
    .romantic-title {
      font-family: 'Cormorant Garamond', serif;
    }
    
    .script-font {
      font-family: 'Dancing Script', cursive;
    }
    
    .elegant-font {
      font-family: 'Playfair Display', serif;
    }
    
    /* Floating animations */
    @keyframes floatUp {
      0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
      }
    }
    
    @keyframes floatUpPink {
      0% {
        transform: translateY(100vh) rotate(180deg) translateX(-30px);
        opacity: 0;
      }
      10% {
        opacity: 0.6;
      }
      90% {
        opacity: 0.6;
      }
      100% {
        transform: translateY(-100px) rotate(540deg) translateX(30px);
        opacity: 0;
      }
    }
    
    .floating-element {
      position: fixed;
      pointer-events: none;
      z-index: 1;
      animation: floatUp linear forwards;
    }
    
    .floating-element.pink {
      animation: floatUpPink linear forwards;
    }
    
    /* Heart animations */
    @keyframes gentlePulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.9;
      }
      50% {
        transform: scale(1.08);
        opacity: 1;
      }
    }
    
    @keyframes heartbeat {
      0% {
        transform: scale(1);
      }
      14% {
        transform: scale(1.1);
      }
      28% {
        transform: scale(1);
      }
      42% {
        transform: scale(1.1);
      }
      70% {
        transform: scale(1);
      }
    }
    
    .gentle-pulse {
      animation: gentlePulse 4s ease-in-out infinite;
    }
    
    .heartbeat {
      animation: heartbeat 1.5s ease-in-out infinite;
    }
    
    /* Page transitions */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
        visibility: hidden;
      }
    }
    
    .fade-in {
      animation: fadeIn 0.8s ease-out forwards;
    }
    
    .fade-out {
      animation: fadeOut 0.8s ease-out forwards;
    }
    
    /* Progress indicator */
    .progress-track {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: rgba(232, 221, 212, 0.3);
      z-index: 1000;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--sage), var(--rose-gold));
      width: 0%;
      transition: width 0.6s ease;
      border-radius: 0 3px 3px 0;
    }
    
    /* Navigation */
    .nav-dots {
      position: fixed;
      right: 24px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .nav-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(125, 139, 111, 0.2);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .nav-dot:hover {
      background: var(--rose-gold);
      transform: scale(1.4);
    }
    
    .nav-dot.active {
      background: var(--rose-gold);
      transform: scale(1.4);
      box-shadow: 0 0 0 2px rgba(183, 110, 121, 0.1);
    }
    
    .nav-dot.completed:after {
      content: '‚úì';
      position: absolute;
      top: -2px;
      left: 1px;
      font-size: 8px;
      color: white;
    }
    
    /* Cards and containers */
    .elegant-card {
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 
        0 10px 40px rgba(92, 107, 79, 0.08),
        0 1px 3px rgba(0, 0, 0, 0.03);
      border: 1px solid rgba(232, 221, 212, 0.6);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      padding: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 15px 35px rgba(183, 110, 121, 0.08),
        0 5px 15px rgba(0, 0, 0, 0.03);
    }
    
    /* Buttons */
    .primary-btn {
      background: linear-gradient(135deg, var(--rose-gold), var(--deep-pink));
      color: white;
      border: none;
      padding: 14px 32px;
      border-radius: 50px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .primary-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(183, 110, 121, 0.25);
      background: linear-gradient(135deg, var(--deep-pink), var(--rose-gold));
    }
    
    .primary-btn:active {
      transform: translateY(-1px);
    }
    
    .secondary-btn {
      background: transparent;
      color: var(--rose-gold);
      border: 2px solid var(--rose-gold);
      padding: 12px 28px;
      border-radius: 50px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .secondary-btn:hover {
      background: rgba(183, 110, 121, 0.08);
      transform: translateY(-2px);
    }
    
    /* Form elements */
    .elegant-input {
      background: transparent;
      border: none;
      border-bottom: 2px solid rgba(183, 110, 121, 0.2);
      padding: 12px 0;
      font-size: 20px;
      font-family: 'Dancing Script', cursive;
      color: var(--deep-sage);
      width: 100%;
      transition: all 0.3s ease;
    }
    
    .elegant-input:focus {
      outline: none;
      border-bottom-color: var(--rose-gold);
      background: rgba(183, 110, 121, 0.03);
      padding-left: 12px;
      padding-right: 12px;
    }
    
    .elegant-input::placeholder {
      color: rgba(183, 110, 121, 0.4);
      font-style: italic;
    }
    
    /* Typography */
    h1, h2, h3, h4 {
      color: #2C3E2F;
      font-weight: 500;
      line-height: 1.2;
    }
    
    .gradient-text {
      background: linear-gradient(135deg, var(--sage), var(--rose-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtle-text {
      color: #5A6B5C;
      line-height: 1.7;
    }
    
    /* Completion states */
    .completion-checkmark {
      width: 24px;
      height: 24px;
      background: var(--sage);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
    }
    
    /* Share view styles */
    .view-only .editable-content,
    .view-only input,
    .view-only textarea {
      pointer-events: none;
      background: transparent;
      border: none;
    }
    
    .view-only .elegant-input {
      border-bottom: 1px solid rgba(183, 110, 121, 0.1);
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .nav-dots {
        right: 16px;
      }
      
      .elegant-card {
        padding: 1.5rem;
        margin: 0 1rem;
      }
      
      h1 {
        font-size: 2.5rem;
      }
      
      .primary-btn, .secondary-btn {
        padding: 12px 24px;
        font-size: 15px;
      }
    }
    
    /* Loading states */
    .loading-dots {
      display: inline-block;
    }
    
    .loading-dots span {
      animation: blink 1.4s infinite both;
      display: inline-block;
    }
    
    .loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes blink {
      0%, 80%, 100% { opacity: 0; }
      40% { opacity: 1; }
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(232, 221, 212, 0.3);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(183, 110, 121, 0.4);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(183, 110, 121, 0.6);
    }
  </style>
</head>
<body class="view-only">
  <!-- Floating Elements -->
  <div id="floating-container"></div>
  
  <!-- Progress Indicator -->
  <div class="progress-track">
    <div id="progress-fill" class="progress-fill"></div>
  </div>
  
  <!-- Navigation Dots -->
  <div class="nav-dots">
    <div class="nav-dot active completed" data-section="welcome"></div>
    <div class="nav-dot" data-section="greeting"></div>
    <div class="nav-dot" data-section="letter"></div>
    <div class="nav-dot" data-section="memories"></div>
    <div class="nav-dot" data-section="final"></div>
  </div>
  
  <!-- Main Content -->
  <main>
    <!-- Welcome Screen -->
    <section id="welcome" class="min-h-screen flex items-center justify-center px-4 relative">
      <div class="text-center max-w-3xl w-full fade-in">
        <div class="elegant-card mx-auto">
          <!-- Logo/Title -->
          <div class="mb-8">
            <div class="inline-flex items-center gap-3 mb-6">
              <div class="w-12 h-12 rounded-full flex items-center justify-center heartbeat" style="background: linear-gradient(135deg, var(--sage), var(--rose-gold));">
                <i class="fas fa-heart text-white text-xl"></i>
              </div>
              <h1 class="text-4xl elegant-font">Heart Map</h1>
            </div>
            <p class="subtle-text mb-2">An Interactive Love Letter</p>
          </div>
          
          <!-- Main Heart Visual -->
          <div class="mb-10">
            <div class="relative inline-block">
              <div class="w-48 h-48 mx-auto rounded-full flex items-center justify-center gentle-pulse" style="background: linear-gradient(135deg, rgba(125, 139, 111, 0.1), rgba(183, 110, 121, 0.1));">
                <svg class="w-32 h-32" fill="url(#heartGradient)" viewBox="0 0 24 24">
                  <defs>
                    <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#7D8B6F;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#B76E79;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
              </div>
              <div class="absolute -top-2 -right-2 w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-lg">
                <i class="fas fa-map-marker-alt text-rose-gold"></i>
              </div>
            </div>
          </div>
          
          <!-- Tagline -->
          <h2 class="text-5xl md:text-6xl elegant-font mb-6 gradient-text">
            Map Your Heart
          </h2>
          
          <p class="text-xl subtle-text mb-10 max-w-2xl mx-auto">
            Create a personalized, interactive love story for your special someone. 
            Every click adds to your unique journey together.
          </p>
          
          <!-- Start Button -->
          <div class="space-y-4">
            <button id="start-btn" class="primary-btn w-full max-w-sm mx-auto">
              <span class="flex items-center justify-center gap-2">
                <i class="fas fa-play"></i>
                Begin Your Heart Map
              </span>
            </button>
            
            <p class="text-sm subtle-text">
              <i class="fas fa-info-circle mr-1"></i>
              Follow the dots on the right to navigate
            </p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Greeting Section -->
    <section id="greeting" class="min-h-screen flex items-center justify-center px-4 py-20">
      <div class="max-w-2xl w-full fade-in">
        <div class="elegant-card">
          <div class="mb-8 text-center">
            <div class="inline-flex items-center gap-2 mb-4">
              <span class="completion-checkmark">1</span>
              <span class="text-sm font-medium text-sage">STEP 1 OF 4</span>
            </div>
            <h2 class="text-4xl elegant-font mb-4">To My Dearest</h2>
            <p class="subtle-text">Start by personalizing this letter with your loved one's name</p>
          </div>
          
          <div class="space-y-8">
            <div>
              <label class="block text-sm font-medium mb-2 subtle-text">Their Name</label>
              <input 
                type="text" 
                id="partner-name" 
                class="elegant-input text-3xl script-font text-center"
                placeholder="Enter their name..."
                maxlength="30"
              >
              <p class="text-xs subtle-text mt-2 text-center">This will appear throughout your love letter</p>
            </div>
            
            <div>
              <label class="block text-sm font-medium mb-2 subtle-text">Your Name</label>
              <input 
                type="text" 
                id="your-name" 
                class="elegant-input text-2xl script-font text-center"
                placeholder="Your name..."
                maxlength="30"
              >
            </div>
            
            <div class="pt-6 border-t border-blush">
              <div class="flex items-center justify-between">
                <button data-section="welcome" class="secondary-btn">
                  <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
                
                <button data-section="letter" class="primary-btn" id="next-to-letter">
                  Continue to Letter
                  <i class="fas fa-arrow-right ml-2"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Letter Section -->
    <section id="letter" class="min-h-screen flex items-center justify-center px-4 py-20">
      <div class="max-w-3xl w-full fade-in">
        <div class="glass-card">
          <div class="mb-8 text-center">
            <div class="inline-flex items-center gap-2 mb-4">
              <span class="completion-checkmark">2</span>
              <span class="text-sm font-medium text-sage">STEP 2 OF 4</span>
            </div>
            <h2 class="text-4xl elegant-font mb-4">Your Love Letter</h2>
            <p class="subtle-text mb-6">Write from your heart. These words will be treasured forever.</p>
          </div>
          
          <!-- Letter Content -->
          <div class="space-y-6">
            <!-- Date -->
            <div class="text-right">
              <input 
                type="text" 
                id="letter-date" 
                class="elegant-input text-right max-w-xs ml-auto"
                placeholder="Today's date..."
                value="February 14, 2024"
              >
            </div>
            
            <!-- Salutation -->
            <div class="text-center mb-8">
              <h3 class="text-3xl script-font gradient-text" id="letter-salutation">My Dearest <span id="letter-partner-name">[Name]</span></h3>
            </div>
            
            <!-- Letter Body -->
            <div class="space-y-8">
              <div>
                <label class="block text-sm font-medium mb-3 subtle-text">Opening</label>
                <textarea 
                  id="letter-opening"
                  class="w-full elegant-input min-h-[100px] p-4 rounded-lg border border-blush resize-none"
                  placeholder="My love, the moment I met you..."
                  rows="3"
                ></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-3 subtle-text">What I Love About You</label>
                <textarea 
                  id="letter-body"
                  class="w-full elegant-input min-h-[150px] p-4 rounded-lg border border-blush resize-none"
                  placeholder="I love the way you... Your smile reminds me of... The thing I cherish most is..."
                  rows="5"
                ></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-3 subtle-text">My Promise to You</label>
                <textarea 
                  id="letter-promise"
                  class="w-full elegant-input min-h-[100px] p-4 rounded-lg border border-blush resize-none"
                  placeholder="I promise to always... Together, we will..."
                  rows="3"
                ></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-3 subtle-text">Closing</label>
                <textarea 
                  id="letter-closing"
                  class="w-full elegant-input min-h-[80px] p-4 rounded-lg border border-blush resize-none"
                  placeholder="With all my love and admiration..."
                  rows="2"
                ></textarea>
              </div>
            </div>
            
            <!-- Signature -->
            <div class="text-center mt-12 pt-8 border-t border-blush">
              <div class="mb-4">
                <span class="text-3xl script-font gradient-text" id="letter-signature">[Your Name]</span>
              </div>
              <p class="text-sm subtle-text italic">Forever yours</p>
            </div>
            
            <!-- Navigation -->
            <div class="flex items-center justify-between pt-8">
              <button data-section="greeting" class="secondary-btn">
                <i class="fas fa-arrow-left mr-2"></i>Back
              </button>
              
              <button data-section="memories" class="primary-btn">
                Add Memories
                <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Memories Section -->
    <section id="memories" class="min-h-screen flex items-center justify-center px-4 py-20">
      <div class="max-w-6xl w-full fade-in">
        <div class="glass-card">
          <div class="mb-10 text-center">
            <div class="inline-flex items-center gap-2 mb-4">
              <span class="completion-checkmark">3</span>
              <span class="text-sm font-medium text-sage">STEP 3 OF 4</span>
            </div>
            <h2 class="text-4xl elegant-font mb-4">Our Treasured Moments</h2>
            <p class="subtle-text mb-6">Add photos and memories that tell our story</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            <!-- Memory 1 -->
            <div class="group">
              <div class="aspect-square rounded-2xl overflow-hidden bg-gradient-to-br from-blush/20 to-pale-pink/20 border-2 border-dashed border-rose-gold/30 flex flex-col items-center justify-center p-6 cursor-pointer transition-all duration-300 hover:border-rose-gold/60 hover:scale-[1.02]" id="memory-1">
                <div class="text-center">
                  <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background: linear-gradient(135deg, var(--rose-gold), var(--deep-pink));">
                    <i class="fas fa-camera text-white text-xl"></i>
                  </div>
                  <h4 class="font-medium mb-2">Our First Memory</h4>
                  <p class="text-sm subtle-text mb-4">Click to add a photo</p>
                </div>
              </div>
              <div class="mt-4">
                <textarea 
                  class="w-full elegant-input min-h-[80px] p-3 rounded-lg border border-blush resize-none text-center"
                  placeholder="Describe this special moment..."
                  rows="2"
                ></textarea>
              </div>
            </div>
            
            <!-- Memory 2 -->
            <div class="group">
              <div class="aspect-square rounded-2xl overflow-hidden bg-gradient-to-br from-blush/20 to-pale-pink/20 border-2 border-dashed border-rose-gold/30 flex flex-col items-center justify-center p-6 cursor-pointer transition-all duration-300 hover:border-rose-gold/60 hover:scale-[1.02]" id="memory-2">
                <div class="text-center">
                  <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background: linear-gradient(135deg, var(--sage), var(--moss));">
                    <i class="fas fa-heart text-white text-xl"></i>
                  </div>
                  <h4 class="font-medium mb-2">A Happy Moment</h4>
                  <p class="text-sm subtle-text mb-4">Click to add a photo</p>
                </div>
              </div>
              <div class="mt-4">
                <textarea 
                  class="w-full elegant-input min-h-[80px] p-3 rounded-lg border border-blush resize-none text-center"
                  placeholder="What made this day special?"
                  rows="2"
                ></textarea>
              </div>
            </div>
            
            <!-- Memory 3 -->
            <div class="group">
              <div class="aspect-square rounded-2xl overflow-hidden bg-gradient-to-br from-blush/20 to-pale-pink/20 border-2 border-dashed border-rose-gold/30 flex flex-col items-center justify-center p-6 cursor-pointer transition-all duration-300 hover:border-rose-gold/60 hover:scale-[1.02]" id="memory-3">
                <div class="text-center">
                  <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4" style="background: linear-gradient(135deg, var(--rose-gold), var(--soft-pink));">
                    <i class="fas fa-star text-white text-xl"></i>
                  </div>
                  <h4 class="font-medium mb-2">Looking Forward</h4>
                  <p class="text-sm subtle-text mb-4">Click to add a photo</p>
                </div>
              </div>
              <div class="mt-4">
                <textarea 
                  class="w-full elegant-input min-h-[80px] p-3 rounded-lg border border-blush resize-none text-center"
                  placeholder="Our dreams for the future..."
                  rows="2"
                ></textarea>
              </div>
            </div>
          </div>
          
          <!-- Music Player -->
          <div class="mb-10">
            <div class="max-w-md mx-auto">
              <div class="text-center mb-6">
                <h3 class="text-xl elegant-font mb-2">Our Song</h3>
                <p class="subtle-text text-sm">Add a song that reminds you of them</p>
              </div>
              
              <div class="bg-white rounded-xl p-6 shadow-sm border border-blush">
                <div class="flex items-center justify-between mb-4">
                  <div>
                    <div id="song-title" class="font-medium">No song selected</div>
                    <div id="song-status" class="text-sm subtle-text">Upload an MP3 file</div>
                  </div>
                  <button id="upload-song-btn" class="secondary-btn">
                    <i class="fas fa-upload mr-2"></i>Upload
                  </button>
                </div>
                
                <div class="flex items-center justify-center gap-4">
                  <button id="prev-btn" class="w-10 h-10 rounded-full border border-blush flex items-center justify-center hover:bg-blush/20">
                    <i class="fas fa-step-backward"></i>
                  </button>
                  
                  <button id="play-btn" class="w-14 h-14 rounded-full primary-btn flex items-center justify-center">
                    <i id="play-icon" class="fas fa-play"></i>
                    <i id="pause-icon" class="fas fa-pause hidden"></i>
                  </button>
                  
                  <button id="next-btn" class="w-10 h-10 rounded-full border border-blush flex items-center justify-center hover:bg-blush/20">
                    <i class="fas fa-step-forward"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Navigation -->
          <div class="flex items-center justify-between pt-8 border-t border-blush">
            <button data-section="letter" class="secondary-btn">
              <i class="fas fa-arrow-left mr-2"></i>Back to Letter
            </button>
            
            <button data-section="final" class="primary-btn">
              Preview & Share
              <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Final & Share Section -->
    <section id="final" class="min-h-screen flex items-center justify-center px-4 py-20">
      <div class="max-w-3xl w-full fade-in">
        <div class="elegant-card">
          <div class="text-center mb-10">
            <div class="inline-flex items-center gap-2 mb-4">
              <span class="completion-checkmark">4</span>
              <span class="text-sm font-medium text-sage">STEP 4 OF 4 - COMPLETE!</span>
            </div>
            
            <div class="mb-8">
              <div class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 heartbeat" style="background: linear-gradient(135deg, var(--sage), var(--rose-gold));">
                <i class="fas fa-check text-white text-2xl"></i>
              </div>
              <h2 class="text-5xl elegant-font mb-4 gradient-text">Your Heart Map is Ready!</h2>
              <p class="subtle-text text-lg">Preview your creation before sharing it with your loved one</p>
            </div>
          </div>
          
          <!-- Preview Card -->
          <div class="mb-10">
            <div class="bg-gradient-to-br from-blush/20 to-pale-pink/10 rounded-2xl p-8 border border-blush">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h3 class="text-2xl elegant-font">Preview</h3>
                  <p class="subtle-text">This is what your partner will see</p>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full bg-rose-gold animate-pulse"></div>
                  <span class="text-sm font-medium">View Only Mode</span>
                </div>
              </div>
              
              <div class="space-y-6">
                <div class="flex items-center gap-3">
                  <i class="fas fa-check-circle text-sage"></i>
                  <span>Personalized greeting for <span id="preview-name" class="font-medium">[Name]</span></span>
                </div>
                <div class="flex items-center gap-3">
                  <i class="fas fa-check-circle text-sage"></i>
                  <span>Love letter with <span id="preview-letter-length" class="font-medium">0</span> words</span>
                </div>
                <div class="flex items-center gap-3">
                  <i class="fas fa-check-circle text-sage"></i>
                  <span><span id="preview-photo-count" class="font-medium">0</span> memory photos</span>
                </div>
                <div class="flex items-center gap-3">
                  <i class="fas fa-check-circle text-sage"></i>
                  <span>Personal soundtrack included</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Important Note -->
          <div class="mb-10 p-6 rounded-xl bg-gradient-to-r from-rose-gold/5 to-sage/5 border border-rose-gold/20">
            <div class="flex items-start gap-3">
              <i class="fas fa-lock mt-1 text-rose-gold"></i>
              <div>
                <h4 class="font-medium mb-2">Important: View-Only Mode</h4>
                <p class="text-sm subtle-text">
                  Once shared, your Heart Map becomes <span class="font-medium">view-only</span> for your partner. 
                  They can experience your love story but cannot edit it. At the end, they'll have the option to create their own Heart Map for you.
                </p>
              </div>
            </div>
          </div>
          
          <!-- Share Buttons -->
          <div class="space-y-4 mb-8">
            <h3 class="text-xl elegant-font text-center">Share Your Heart Map</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <button id="whatsapp-share" class="secondary-btn flex items-center justify-center gap-3">
                <i class="fab fa-whatsapp text-green-500 text-lg"></i>
                Share via WhatsApp
              </button>
              
              <button id="copy-link" class="secondary-btn flex items-center justify-center gap-3">
                <i class="fas fa-link text-rose-gold text-lg"></i>
                Copy Link
              </button>
            </div>
            
            <div class="text-center">
              <button id="save-draft" class="text-sm subtle-text hover:text-rose-gold transition-colors">
                <i class="fas fa-save mr-1"></i>
                Save as draft to continue later
              </button>
            </div>
          </div>
          
          <!-- Create Your Own Button (Visible only to partner) -->
          <div id="create-your-own-section" class="hidden">
            <div class="text-center pt-8 border-t border-blush">
              <p class="subtle-text mb-4">Received this Heart Map from someone special?</p>
              <button id="create-your-own-btn" class="primary-btn">
                <i class="fas fa-heart mr-2"></i>
                Create Your Own Heart Map
              </button>
              <p class="text-xs subtle-text mt-3">Start a new interactive love letter to return the gesture</p>
            </div>
          </div>
          
          <!-- Final Navigation -->
          <div class="flex items-center justify-between pt-8 border-t border-blush">
            <button data-section="memories" class="secondary-btn">
              <i class="fas fa-edit mr-2"></i>Edit
            </button>
            
            <div class="flex items-center gap-2 subtle-text">
              <i class="fas fa-info-circle"></i>
              <span class="text-sm">All data is saved locally in your browser</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <!-- Hidden File Inputs -->
  <input type="file" id="image-upload" class="hidden" accept="image/*">
  <input type="file" id="audio-upload" class="hidden" accept="audio/*">
  <audio id="audio-player" class="hidden"></audio>
  
  <script>
    // ========== STATE MANAGEMENT ==========
    const HeartMapState = {
      isCreator: true,
      isViewOnly: false,
      currentSection: 'welcome',
      completedSections: new Set(['welcome']),
      data: {
        partnerName: '',
        yourName: '',
        letter: {
          date: 'February 14, 2024',
          opening: '',
          body: '',
          promise: '',
          closing: ''
        },
        memories: [{}, {}, {}],
        song: null
      },
      save() {
        localStorage.setItem('heartMapData', JSON.stringify(this.data));
        localStorage.setItem('heartMapCompleted', JSON.stringify([...this.completedSections]));
      },
      load() {
        const saved = localStorage.getItem('heartMapData');
        const completed = localStorage.getItem('heartMapCompleted');
        if (saved) this.data = JSON.parse(saved);
        if (completed) this.completedSections = new Set(JSON.parse(completed));
        return this;
      },
      reset() {
        this.data = {
          partnerName: '',
          yourName: '',
          letter: {
            date: 'February 14, 2024',
            opening: '',
            body: '',
            promise: '',
            closing: ''
          },
          memories: [{}, {}, {}],
          song: null
        };
        this.completedSections = new Set(['welcome']);
        this.isCreator = true;
        this.save();
      }
    };
    
    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      // Load saved state
      HeartMapState.load();
      
      // Initialize components
      initFloatingElements();
      initNavigation();
      initFormBindings();
      initMediaUpload();
      initMusicPlayer();
      initShareFunctions();
      initPreviewUpdates();
      
      // Check if viewing as partner
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('view')) {
        HeartMapState.isCreator = false;
        HeartMapState.isViewOnly = true;
        document.body.classList.add('view-only');
        document.getElementById('create-your-own-section').classList.remove('hidden');
      }
      
      // Update UI based on state
      updateUIFromState();
      updateProgress();
      
      console.log('Heart Map initialized');
    });
    
    // ========== FLOATING ELEMENTS ==========
    function initFloatingElements() {
      createFloatingElements();
      setInterval(createFloatingElements, 5000);
    }
    
    function createFloatingElements() {
      const container = document.getElementById('floating-container');
      const elements = ['üíñ', 'üíó', 'üíì', 'üíï', 'üíû', 'üå∏', 'üå∫', 'üå∑', 'üçÉ', 'üåø'];
      
      for (let i = 0; i < 5; i++) {
        const element = document.createElement('div');
        const isPink = Math.random() > 0.3;
        const elem = elements[Math.floor(Math.random() * elements.length)];
        
        element.textContent = elem;
        element.className = `floating-element ${isPink ? 'pink' : ''}`;
        
        element.style.left = `${Math.random() * 100}vw`;
        element.style.fontSize = `${Math.random() * 20 + 16}px`;
        element.style.opacity = Math.random() * 0.4 + 0.1;
        element.style.color = isPink ? getRandomPink() : getRandomGreen();
        element.style.animationDuration = `${Math.random() * 15 + 15}s`;
        
        container.appendChild(element);
        setTimeout(() => element.remove(), 30000);
      }
    }
    
    function getRandomPink() {
      const pinks = ['#B76E79', '#C9A9A6', '#E8B4B8', '#F5C6D6'];
      return pinks[Math.floor(Math.random() * pinks.length)];
    }
    
    function getRandomGreen() {
      const greens = ['#7D8B6F', '#5C6B4F', '#6B7B5E', '#8A9B7C'];
      return greens[Math.floor(Math.random() * greens.length)];
    }
    
    // ========== NAVIGATION ==========
    function initNavigation() {
      // Navigation dots
      document.querySelectorAll('.nav-dot').forEach(dot => {
        dot.addEventListener('click', () => {
          const section = dot.dataset.section;
          scrollToSection(section);
        });
      });
      
      // Section navigation buttons
      document.querySelectorAll('button[data-section]').forEach(btn => {
        btn.addEventListener('click', () => {
          const section = btn.dataset.section;
          scrollToSection(section);
        });
      });
      
      // Start button
      document.getElementById('start-btn').addEventListener('click', () => {
        scrollToSection('greeting');
      });
      
      // Scroll tracking
      window.addEventListener('scroll', () => {
        updateActiveSection();
        updateProgress();
      });
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') navigateNext();
        if (e.key === 'ArrowLeft') navigatePrev();
      });
    }
    
    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.scrollIntoView({ behavior: 'smooth' });
        HeartMapState.currentSection = sectionId;
        updateNavigationDots();
        
        // Mark as completed if editing
        if (!HeartMapState.completedSections.has(sectionId)) {
          HeartMapState.completedSections.add(sectionId);
          HeartMapState.save();
          updateNavigationDots();
        }
      }
    }
    
    function updateActiveSection() {
      const sections = ['welcome', 'greeting', 'letter', 'memories', 'final'];
      const scrollPos = window.scrollY + 100;
      
      for (const sectionId of sections) {
        const section = document.getElementById(sectionId);
        if (section) {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;
          
          if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
            HeartMapState.currentSection = sectionId;
            updateNavigationDots();
            break;
          }
        }
      }
    }
    
    function updateNavigationDots() {
      document.querySelectorAll('.nav-dot').forEach(dot => {
        const section = dot.dataset.section;
        dot.classList.remove('active');
        
        if (section === HeartMapState.currentSection) {
          dot.classList.add('active');
        }
        
        if (HeartMapState.completedSections.has(section)) {
          dot.classList.add('completed');
        }
      });
    }
    
    function navigateNext() {
      const sections = ['welcome', 'greeting', 'letter', 'memories', 'final'];
      const currentIndex = sections.indexOf(HeartMapState.currentSection);
      if (currentIndex < sections.length - 1) {
        scrollToSection(sections[currentIndex + 1]);
      }
    }
    
    function navigatePrev() {
      const sections = ['welcome', 'greeting', 'letter', 'memories', 'final'];
      const currentIndex = sections.indexOf(HeartMapState.currentSection);
      if (currentIndex > 0) {
        scrollToSection(sections[currentIndex - 1]);
      }
    }
    
    // ========== PROGRESS INDICATOR ==========
    function updateProgress() {
      const totalSections = 5;
      const completed = HeartMapState.completedSections.size;
      const progress = (completed / totalSections) * 100;
      
      document.getElementById('progress-fill').style.width = `${progress}%`;
    }
    
    // ========== FORM BINDINGS ==========
    function initFormBindings() {
      // Partner name
      const partnerNameInput = document.getElementById('partner-name');
      partnerNameInput.addEventListener('input', (e) => {
        HeartMapState.data.partnerName = e.target.value;
        HeartMapState.save();
        updatePreview();
      });
      
      // Your name
      const yourNameInput = document.getElementById('your-name');
      yourNameInput.addEventListener('input', (e) => {
        HeartMapState.data.yourName = e.target.value;
        HeartMapState.save();
        updatePreview();
      });
      
      // Letter sections
      ['opening', 'body', 'promise', 'closing'].forEach(section => {
        const element = document.getElementById(`letter-${section}`);
        if (element) {
          element.addEventListener('input', (e) => {
            HeartMapState.data.letter[section] = e.target.value;
            HeartMapState.save();
            updatePreview();
          });
        }
      });
      
      // Letter date
      document.getElementById('letter-date').addEventListener('input', (e) => {
        HeartMapState.data.letter.date = e.target.value;
        HeartMapState.save();
      });
    }
    
    function updateUIFromState() {
      // Partner name
      document.getElementById('partner-name').value = HeartMapState.data.partnerName;
      document.getElementById('letter-partner-name').textContent = HeartMapState.data.partnerName || '[Name]';
      document.getElementById('preview-name').textContent = HeartMapState.data.partnerName || '[Name]';
      
      // Your name
      document.getElementById('your-name').value = HeartMapState.data.yourName;
      document.getElementById('letter-signature').textContent = HeartMapState.data.yourName || '[Your Name]';
      
      // Letter sections
      Object.keys(HeartMapState.data.letter).forEach(section => {
        const element = document.getElementById(`letter-${section}`);
        if (element) element.value = HeartMapState.data.letter[section];
      });
      
      updatePreview();
    }
    
    // ========== MEDIA UPLOAD ==========
    function initMediaUpload() {
      const imageUpload = document.getElementById('image-upload');
      const memoryElements = ['memory-1', 'memory-2', 'memory-3'];
      
      memoryElements.forEach((id, index) => {
        const element = document.getElementById(id);
        element.addEventListener('click', () => {
          currentMemoryIndex = index;
          imageUpload.click();
        });
      });
      
      imageUpload.addEventListener('change', handleImageUpload);
    }
    
    let currentMemoryIndex = 0;
    
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (event) => {
        const memoryElement = document.getElementById(`memory-${currentMemoryIndex + 1}`);
        if (memoryElement) {
          memoryElement.innerHTML = `
            <img src="${event.target.result}" 
                 class="w-full h-full object-cover rounded-2xl"
                 alt="Memory ${currentMemoryIndex + 1}">
            <div class="absolute inset-0 bg-black/20 opacity-0 hover:opacity-100 transition-opacity duration-300 rounded-2xl flex items-center justify-center">
              <div class="w-12 h-12 rounded-full bg-white/80 flex items-center justify-center">
                <i class="fas fa-edit text-rose-gold"></i>
              </div>
            </div>
          `;
          
          // Save to state
          HeartMapState.data.memories[currentMemoryIndex] = {
            image: event.target.result,
            caption: memoryElement.nextElementSibling?.querySelector('textarea')?.value || ''
          };
          HeartMapState.save();
          updatePreview();
          
          // Success animation
          memoryElement.style.animation = 'gentlePulse 1s';
          setTimeout(() => memoryElement.style.animation = '', 1000);
        }
      };
      reader.readAsDataURL(file);
      
      // Reset input
      e.target.value = '';
    }
    
    // ========== MUSIC PLAYER ==========
    function initMusicPlayer() {
      const audio = document.getElementById('audio-player');
      const playBtn = document.getElementById('play-btn');
      const playIcon = document.getElementById('play-icon');
      const pauseIcon = document.getElementById('pause-icon');
      const uploadBtn = document.getElementById('upload-song-btn');
      const audioUpload = document.getElementById('audio-upload');
      const songTitle = document.getElementById('song-title');
      
      let isPlaying = false;
      let currentSong = HeartMapState.data.song;
      
      // Load saved song
      if (currentSong) {
        audio.src = currentSong.url;
        songTitle.textContent = currentSong.name;
      }
      
      playBtn.addEventListener('click', () => {
        if (!audio.src) {
          alert('Please upload a song first');
          uploadBtn.click();
          return;
        }
        
        if (isPlaying) {
          audio.pause();
        } else {
          audio.play().catch(e => {
            console.error('Playback error:', e);
            alert('Unable to play the audio file. Please try another.');
          });
        }
        
        isPlaying = !isPlaying;
        playIcon.classList.toggle('hidden', isPlaying);
        pauseIcon.classList.toggle('hidden', !isPlaying);
      });
      
      uploadBtn.addEventListener('click', () => {
        audioUpload.click();
      });
      
      audioUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        if (!file.type.startsWith('audio/')) {
          alert('Please select an audio file');
          return;
        }
        
        const url = URL.createObjectURL(file);
        currentSong = {
          name: file.name.replace(/\.[^/.]+$/, ""),
          url: url
        };
        
        audio.src = url;
        songTitle.textContent = currentSong.name;
        
        // Save to state
        HeartMapState.data.song = currentSong;
        HeartMapState.save();
        
        // Auto-play
        setTimeout(() => {
          audio.play();
          isPlaying = true;
          playIcon.classList.add('hidden');
          pauseIcon.classList.remove('hidden');
        }, 300);
      });
      
      audio.addEventListener('ended', () => {
        isPlaying = false;
        playIcon.classList.remove('hidden');
        pauseIcon.classList.add('hidden');
      });
    }
    
    // ========== SHARE FUNCTIONS ==========
    function initShareFunctions() {
      // WhatsApp share
      document.getElementById('whatsapp-share').addEventListener('click', () => {
        // First, ensure all data is saved
        HeartMapState.save();
        
        const text = `üíñ I created a Heart Map love letter just for you! üíñ\n\nClick the link to view my heartfelt message:\n${getShareableLink()}`;
        const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
        window.open(url, '_blank');
      });
      
      // Copy link
      document.getElementById('copy-link').addEventListener('click', async () => {
        // First, ensure all data is saved
        HeartMapState.save();
        
        const link = getShareableLink();
        try {
          await navigator.clipboard.writeText(link);
          showNotification('Link copied to clipboard! Send this to your partner.');
          
          // Change button text temporarily
          const btn = document.getElementById('copy-link');
          const originalHTML = btn.innerHTML;
          btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
          setTimeout(() => btn.innerHTML = originalHTML, 2000);
        } catch (err) {
          // Fallback
          const textArea = document.createElement('textarea');
          textArea.value = link;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showNotification('Link copied to clipboard! Send this to your partner.');
        }
      });
      
      // Save draft
      document.getElementById('save-draft').addEventListener('click', () => {
        HeartMapState.save();
        showNotification('Draft saved! You can continue anytime.');
      });
      
      // Create your own (for partner)
      document.getElementById('create-your-own-btn').addEventListener('click', () => {
        HeartMapState.reset();
        window.location.href = window.location.origin + window.location.pathname;
      });
    }
    
    function getShareableLink() {
      // Generate a unique view link
      const baseUrl = window.location.origin + window.location.pathname;
      const viewUrl = `${baseUrl}?view=true&id=${Date.now()}`;
      return viewUrl;
    }
    
    function showNotification(message) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = 'fixed top-6 right-6 bg-white rounded-lg shadow-lg p-4 border-l-4 border-rose-gold z-50 max-w-sm';
      notification.innerHTML = `
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-full bg-rose-gold/10 flex items-center justify-center">
            <i class="fas fa-check text-rose-gold"></i>
          </div>
          <div>
            <p class="font-medium">${message}</p>
          </div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(20px)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    // ========== PREVIEW UPDATES ==========
    function initPreviewUpdates() {
      updatePreview();
    }
    
    function updatePreview() {
      // Update letter word count
      const letterText = Object.values(HeartMapState.data.letter).join(' ');
      const wordCount = letterText.trim() ? letterText.trim().split(/\s+/).length : 0;
      document.getElementById('preview-letter-length').textContent = wordCount;
      
      // Update photo count
      const photoCount = HeartMapState.data.memories.filter(m => m && m.image).length;
      document.getElementById('preview-photo-count').textContent = photoCount;
    }
  </script>
</body>
</html>
