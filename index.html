<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valentine Love Letter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;1,300&family=Great+Vibes&family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    :root {
      --cream: #FDF8F3;
      --sage: #7D8B6F;
      --deep-sage: #5C6B4F;
      --blush: #E8DDD4;
      --moss: #4A5D3E;
    }

    body { background-color: var(--cream); color: var(--deep-sage); font-family: 'Lora', serif; overflow-x: hidden; }
    .fancy-font { font-family: 'Great Vibes', cursive; }
    .serif-title { font-family: 'Cormorant Garamond', serif; text-transform: uppercase; letter-spacing: 0.2em; }

    /* Animated Vine Borders */
    .vine-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 100;
      border: 25px solid transparent;
      border-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cpath d='M0 50 Q 25 0 50 50 T 100 50' fill='none' stroke='%237D8B6F' stroke-width='1.5'/%3E%3Ccircle cx='50' cy='50' r='2' fill='%234A5D3E'/%3E%3C/svg%3E") 30 round;
    }

    /* Floating Particles */
    .particle {
      position: fixed;
      pointer-events: none;
      opacity: 0.4;
      z-index: 1;
      animation: float-up linear infinite;
    }

    @keyframes float-up {
      0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
    }

    /* Section Styles */
    .hero-gradient {
      background: radial-gradient(circle at center, rgba(232, 221, 212, 0.5) 0%, rgba(253, 248, 243, 1) 70%);
    }

    .letter-paper {
      background: #fff;
      background-image: radial-gradient(#e5e5e5 1px, transparent 1px);
      background-size: 30px 30px;
      box-shadow: 20px 20px 60px #d9d4cf, -20px -20px 60px #ffffff;
      line-height: 2.2;
      letter-spacing: 0.08em;
    }

    /* The Tree */
    .tree-branch {
      stroke: var(--deep-sage);
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
      stroke-dasharray: 1000;
      animation: draw 4s ease-out forwards;
    }

    @keyframes draw { from { stroke-dashoffset: 1000; } to { stroke-dashoffset: 0; } }

    .leaf-node {
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      filter: sepia(20%);
    }

    .leaf-node:hover {
      transform: scale(1.1) rotate(3deg);
      filter: sepia(0%);
      z-index: 50;
    }

    /* Scratch Card */
    .scratch-box {
      width: 300px;
      height: 150px;
      position: relative;
      touch-action: none;
    }

    #scratch-canvas {
      position: absolute;
      top: 0;
      left: 0;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="10" fill="rgba(125, 139, 111, 0.5)"/></svg>'), auto;
    }

    .scroll-indicator {
      animation: bounce 2s infinite;
    }

    @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
  </style>
 </head>
 <body class="h-full">
  <div class="vine-container"></div>
  
  <div id="app-wrapper" class="h-full overflow-y-auto scroll-smooth">
   
   <section class="min-h-screen flex flex-col items-center justify-center relative px-6 hero-gradient">
    <div class="text-center z-10">
      <h2 class="serif-title text-sm mb-4">A Curated Moment for</h2>
      <div class="relative inline-block mb-8">
        <input type="text" id="partner-name" placeholder="Beloved" 
               class="bg-transparent text-center text-7xl md:text-9xl fancy-font text-sage border-none outline-none focus:ring-0 w-full px-4">
        <div class="h-px w-full bg-sage/30 absolute bottom-2"></div>
      </div>
      <p class="text-deep-sage italic max-w-md mx-auto mb-12 opacity-80">
        "Love is not just a feeling, it's a garden we grow together, one leaf at a time."
      </p>
      <a href="#letter" class="inline-block border border-sage px-12 py-4 text-sage hover:bg-sage hover:text-cream transition-all duration-700 tracking-widest text-xs uppercase">
        Explore the Heart
      </a>
    </div>
    <div class="absolute bottom-10 scroll-indicator">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/></svg>
    </div>
   </section>

   <section id="letter" class="min-h-screen bg-blush/30 py-24 px-6 flex items-center justify-center">
    <div class="max-w-3xl w-full">
      <div class="letter-paper p-10 md:p-20 rounded-sm relative overflow-hidden">
        <div class="absolute -top-10 -right-10 opacity-10">
          <svg width="200" height="200" viewBox="0 0 100 100"><path d="M10 50 Q 50 10 90 50 T 10 50" fill="var(--sage)" /></svg>
        </div>
        
        <h3 class="fancy-font text-4xl text-sage mb-10">My Eternal <span class="partner-display">Beloved</span>,</h3>
        
        <textarea id="letter-body" class="w-full bg-transparent border-none focus:ring-0 text-xl md:text-2xl text-deep-sage min-h-[500px] resize-none overflow-hidden" 
                  placeholder="In the silence between heartbeats, I find you..."></textarea>
        
        <div class="mt-12 flex flex-col items-end">
          <p class="text-xs uppercase tracking-widest opacity-60">Yours, until the stars fade</p>
          <p class="fancy-font text-4xl text-sage mt-2">Signature</p>
        </div>
      </div>
      
      <div class="mt-20 text-center">
        <p class="serif-title text-xs mb-8">Scroll to see our memories bloom</p>
      </div>
    </div>
   </section>

   <section class="min-h-screen py-20 relative flex flex-col items-center justify-center">
    <h3 class="serif-title text-xl mb-16">The Memory Willow</h3>
    
    <div class="relative w-full max-w-4xl h-[600px] flex items-center justify-center">
      <svg class="absolute inset-0 w-full h-full" viewBox="0 0 400 400">
        <path class="tree-branch" d="M200 380 C 210 300 190 200 200 100" />
        <path class="tree-branch" d="M200 300 C 150 280 80 250 50 200" />
        <path class="tree-branch" d="M200 250 C 250 230 320 200 350 150" />
        <path class="tree-branch" d="M200 180 C 160 140 100 100 80 50" />
        <path class="tree-branch" d="M200 150 C 240 110 300 80 320 30" />
      </svg>

      <div class="absolute top-[15%] left-[10%] leaf-node bg-white p-2 shadow-xl border border-sage/20 rotate-[-12deg]" onclick="uploadMemory(1)">
        <div id="img-1" class="w-24 h-24 md:w-32 md:h-32 bg-cream flex items-center justify-center text-sage/40">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 5v14M5 12h14"/></svg>
        </div>
      </div>

      <div class="absolute top-[35%] right-[5%] leaf-node bg-white p-2 shadow-xl border border-sage/20 rotate-[8deg]" onclick="uploadMemory(2)">
        <div id="img-2" class="w-24 h-24 md:w-32 md:h-32 bg-cream flex items-center justify-center text-sage/40">
           <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 5v14M5 12h14"/></svg>
        </div>
      </div>

      <div class="absolute bottom-[20%] left-[25%] leaf-node bg-white p-2 shadow-xl border border-sage/20 rotate-[-5deg]" onclick="uploadMemory(3)">
        <div id="img-3" class="w-24 h-24 md:w-32 md:h-32 bg-cream flex items-center justify-center text-sage/40">
           <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 5v14M5 12h14"/></svg>
        </div>
      </div>
    </div>
    <input type="file" id="file-upload" class="hidden" accept="image/*">
   </section>

   <section class="min-h-screen bg-sage/10 flex flex-col items-center justify-center p-6">
     <div class="max-w-md w-full text-center">
       <h3 class="serif-title text-xl mb-4">A Secret Destiny</h3>
       <p class="text-sm italic mb-10 opacity-70">Gently scratch the veil to reveal what the universe says about us...</p>
       
       <div class="scratch-box mx-auto bg-white rounded-lg shadow-inner overflow-hidden border border-sage/20">
         <div class="absolute inset-0 flex items-center justify-center p-6 bg-white">
           <p id="fortune-text" class="fancy-font text-3xl text-sage">"Every soul finds its home in another. I found mine in you."</p>
         </div>
         <canvas id="scratch-canvas" width="300" height="150"></canvas>
       </div>
       
       <div class="mt-20">
         <p class="serif-title text-[10px] opacity-40 uppercase tracking-[0.4em]">Forever & Always</p>
       </div>
     </div>
   </section>

  </div>

  <script>
    // Particle System
    function createParticles() {
      const container = document.body;
      for (let i = 0; i < 15; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const isLeaf = Math.random() > 0.5;
        p.innerHTML = isLeaf ? 
          `<svg width="15" height="15" viewBox="0 0 20 20"><path d="M0 20 Q 10 0 20 20 Z" fill="var(--sage)" opacity="0.4"/></svg>` :
          `<svg width="10" height="10" viewBox="0 0 20 20"><path d="M10 18 C 2 10 2 5 10 5 C 18 5 18 10 10 18" fill="var(--blush)" opacity="0.6"/></svg>`;
        
        p.style.left = Math.random() * 100 + 'vw';
        p.style.animationDuration = (Math.random() * 10 + 10) + 's';
        p.style.animationDelay = (Math.random() * 10) + 's';
        container.appendChild(p);
      }
    }
    createParticles();

    // Data Sync
    const nameInput = document.getElementById('partner-name');
    const displays = document.querySelectorAll('.partner-display');
    const letterInput = document.getElementById('letter-body');

    nameInput.addEventListener('input', (e) => {
      const val = e.target.value || "Beloved";
      displays.forEach(d => d.textContent = val);
      if(window.elementSdk) window.elementSdk.setConfig({partner_name: val});
    });

    letterInput.addEventListener('input', (e) => {
      if(window.elementSdk) window.elementSdk.setConfig({letter_content: e.target.value});
    });

    // Image Uploads
    let currentSlot = 1;
    function uploadMemory(slot) {
      currentSlot = slot;
      document.getElementById('file-upload').click();
    }

    document.getElementById('file-upload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(f) {
          const container = document.getElementById(`img-${currentSlot}`);
          container.innerHTML = `<img src="${f.target.result}" class="w-full h-full object-cover">`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Scratch Card
    const canvas = document.getElementById('scratch-canvas');
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#7D8B6F';
    ctx.fillRect(0, 0, 300, 150);
    ctx.font = '14px Lora';
    ctx.fillStyle = '#FDF8F3';
    ctx.textAlign = 'center';
    ctx.fillText('SCRATCH WITH LOVE', 150, 80);

    let isDrawing = false;
    function scratch(e) {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX || e.touches[0].clientX) - rect.left;
      const y = (e.clientY || e.touches[0].clientY) - rect.top;
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, 20, 0, Math.PI * 2);
      ctx.fill();
    }

    canvas.addEventListener('mousedown', () => isDrawing = true);
    canvas.addEventListener('touchstart', () => isDrawing = true);
    window.addEventListener('mouseup', () => isDrawing = false);
    window.addEventListener('touchend', () => isDrawing = false);
    canvas.addEventListener('mousemove', scratch);
    canvas.addEventListener('touchmove', scratch);

    // Element SDK
    const defaultConfig = {
      partner_name: "Beloved",
      letter_content: "Your love is a journey I never want to end. In every breath, in every glance, I find a reason to love you more. You are my home, my peace, and my greatest adventure.",
      fortune: "Every soul finds its home in another. I found mine in you."
    };

    function onConfigChange(cfg) {
      nameInput.value = cfg.partner_name || "";
      displays.forEach(d => d.textContent = cfg.partner_name || "Beloved");
      letterInput.value = cfg.letter_content || defaultConfig.letter_content;
      document.getElementById('fortune-text').textContent = cfg.fortune || defaultConfig.fortune;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToEditPanelValues: (cfg) => new Map([
          ["partner_name", cfg.partner_name],
          ["letter_content", cfg.letter_content],
          ["fortune", cfg.fortune]
        ])
      });
    }
    onConfigChange(defaultConfig);
  </script>
 </body>
</html>
