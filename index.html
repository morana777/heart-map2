<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valentine Love Letter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&amp;family=Lora:ital,wght@0,400;0,500;1,400&amp;family=Great+Vibes&amp;display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body { box-sizing: border-box; scrollbar-width: none; }
    body::-webkit-scrollbar { display: none; }
    * { font-family: 'Lora', serif; }
    .romantic-title { font-family: 'Cormorant Garamond', serif; }
    .fancy-font { font-family: 'Great Vibes', cursive; }
    
    :root {
      --cream: #FDF8F3;
      --sage: #7D8B6F;
      --deep-sage: #5C6B4F;
      --blush: #E8DDD4;
      --moss: #4A5D3E;
    }
    
    .bg-cream { background-color: var(--cream); }
    .bg-sage { background-color: var(--sage); }
    .bg-blush { background-color: var(--blush); }
    .text-sage { color: var(--sage); }
    .text-deep-sage { color: var(--deep-sage); }
    
    /* Vine Border Overlay */
    .vine-border {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 100;
      border: 20px solid transparent;
      border-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cpath d='M0 0 Q 25 10 50 0 T 100 0 M100 0 Q 90 25 100 50 T 100 100 M100 100 Q 75 90 50 100 T 0 100 M0 100 Q 10 75 0 50 T 0 0' fill='none' stroke='%237D8B6F' stroke-width='1'/%3E%3Ccircle cx='5' cy='5' r='2' fill='%235C6B4F'/%3E%3C/svg%3E") 40 round;
    }

    /* Emotional Animations */
    @keyframes breathe {
      0%, 100% { transform: scale(1); opacity: 0.95; }
      50% { transform: scale(1.01); opacity: 1; }
    }
    
    @keyframes drift {
      0% { transform: translateY(0) rotate(0deg); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
    }

    .breathe-animation { animation: breathe 8s ease-in-out infinite; }
    
    .letter-paper {
      background: linear-gradient(135deg, #FDF8F3 0%, #F5EDE4 100%);
      box-shadow: 0 10px 60px rgba(74, 93, 62, 0.1);
      letter-spacing: 0.05em;
    }
    
    .leaf-photo {
      width: 100px;
      height: 100px;
      border-radius: 60% 40% 70% 30% / 40% 50% 50% 60%;
      overflow: hidden;
      border: 2px solid rgba(125, 139, 111, 0.3);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      background: var(--cream);
    }
    .leaf-photo:hover { transform: scale(1.15) rotate(5deg); z-index: 20; border-color: var(--sage); }

    .scratch-card {
      width: 320px;
      height: 180px;
      position: relative;
      border-radius: 12px;
      overflow: hidden;
    }

    .leaf-particle {
      position: fixed;
      pointer-events: none;
      z-index: 5;
      animation: drift linear forwards;
    }
  </style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-cream overflow-x-hidden">
  <div class="vine-border"></div>
  
  <div id="app-wrapper" class="h-full w-full overflow-auto scroll-smooth">
   
   <section id="section1" class="min-h-screen relative flex items-center justify-center p-6">
    <div class="text-center z-10 max-w-3xl">
     <svg class="mx-auto w-24 h-24 mb-8 opacity-80" viewBox="0 0 100 100">
        <path d="M50 85 C20 60 10 40 10 25 A 20 20 0 0 1 50 25 A 20 20 0 0 1 90 25 C 90 40 80 60 50 85" fill="none" stroke="#7D8B6F" stroke-width="1.5"/>
        <path d="M50 25 Q 60 10 75 15" fill="none" stroke="#5C6B4F" stroke-width="1"/>
        <circle cx="75" cy="15" r="2" fill="#7D8B6F"/>
     </svg>
     
     <h1 class="romantic-title text-5xl md:text-7xl text-deep-sage mb-6">A Letter For...</h1>
     
     <div class="mb-12">
        <input type="text" id="partner-input" placeholder="Your partner's name" class="bg-transparent border-b border-sage text-center text-4xl md:text-6xl fancy-font focus:outline-none text-sage p-2 w-full max-w-md">
     </div>

     <a href="#section2" class="inline-block px-10 py-4 bg-sage text-cream rounded-full text-xl romantic-title hover:bg-moss transition-all transform hover:scale-105 shadow-xl">
        Enter Our Story
      </a>
    </div>
   </section>

   <section id="section2" class="min-h-screen bg-blush flex items-center justify-center p-6">
    <div class="max-w-4xl w-full">
     <div class="letter-paper breathe-animation rounded-2xl p-10 md:p-20 relative">
      <p class="fancy-font text-4xl text-sage mb-8">My Dearest <span id="partner-name-display">Love</span>,</p>
      
      <textarea id="letter-content" class="text-deep-sage text-xl leading-relaxed w-full bg-transparent border-none resize-none focus:outline-none min-h-[450px]" placeholder="Let your heart speak here..."></textarea>
      
      <div class="mt-12 text-right">
        <p class="romantic-title text-2xl text-sage italic">â€” Always Yours</p>
      </div>
     </div>
    </div>
   </section>

   <section id="section3" class="min-h-screen bg-cream flex flex-col items-center justify-center p-6">
    <h2 class="romantic-title text-4xl text-deep-sage mb-2">Our Growing Garden</h2>
    <p class="text-sage mb-16 italic font-light">Each leaf carries a piece of my heart</p>
    
    <div class="relative w-full max-w-2xl h-[500px] flex items-center justify-center">
      <svg class="absolute inset-0 w-full h-full opacity-40" viewBox="0 0 200 200">
        <path d="M100 195 C 105 160 95 120 100 80 M100 150 C 80 140 60 135 40 140 M100 120 C 130 110 150 100 170 110 M100 90 C 70 70 40 60 20 70 M100 70 C 130 50 160 40 180 50" stroke="#5C6B4F" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      </svg>

      <div id="leaf-1" class="absolute top-[10%] left-[20%] leaf-photo flex items-center justify-center cursor-pointer shadow-lg" onclick="triggerPhoto(1)">
        <span class="text-sage text-lg font-light">+</span>
      </div>
      <div id="leaf-2" class="absolute top-[30%] right-[10%] leaf-photo flex items-center justify-center cursor-pointer shadow-lg" onclick="triggerPhoto(2)">
        <span class="text-sage text-lg font-light">+</span>
      </div>
      <div id="leaf-3" class="absolute top-[60%] left-[5%] leaf-photo flex items-center justify-center cursor-pointer shadow-lg" onclick="triggerPhoto(3)">
        <span class="text-sage text-lg font-light">+</span>
      </div>
      <div id="leaf-4" class="absolute top-[75%] right-[25%] leaf-photo flex items-center justify-center cursor-pointer shadow-lg" onclick="triggerPhoto(4)">
        <span class="text-sage text-lg font-light">+</span>
      </div>
    </div>
   </section>

   <section id="section4" class="min-h-screen bg-blush flex flex-col items-center justify-center p-6 text-center">
    <div class="max-w-md">
        <h2 class="romantic-title text-4xl text-deep-sage mb-6">A Secret for You</h2>
        <p class="text-sage mb-12 italic">The universe has a message today. Softly scratch the surface to see it.</p>
        
        <div class="scratch-card shadow-2xl mx-auto">
            <div class="absolute inset-0 flex items-center justify-center bg-white p-6 border border-sage/20">
                <p id="fortune-text" class="romantic-title text-2xl text-deep-sage leading-snug">My soul found its missing piece the moment I met you.</p>
            </div>
            <canvas id="scratch-canvas" class="absolute inset-0 cursor-crosshair" width="320" height="180"></canvas>
        </div>
    </div>
   </section>

   <input type="file" id="photo-input" class="hidden" accept="image/*" onchange="handleFile(event)">
  </div>

  <script>
    const defaultConfig = {
      partner_name: "My Dearest",
      letter_content: "I've written a thousand letters in my head, but none could ever truly capture the way you make me feel. \n\nYou are the steady rhythm in my heart and the peace in my chaos. Thank you for being my person, today and every day after.",
      fortune: "Our love is a quiet strength that will only grow deeper with time."
    };

    // Particles (Organic Leaves)
    function createLeaf() {
        const leaf = document.createElement('div');
        leaf.className = 'leaf-particle';
        const size = Math.random() * 15 + 10;
        leaf.style.width = size + 'px';
        leaf.style.height = size + 'px';
        leaf.style.left = Math.random() * 100 + 'vw';
        leaf.style.bottom = '-20px';
        leaf.style.backgroundColor = Math.random() > 0.5 ? '#7D8B6F' : '#E8DDD4';
        leaf.style.borderRadius = '0 100% 0 100%';
        leaf.style.animationDuration = (Math.random() * 5 + 10) + 's';
        document.body.appendChild(leaf);
        setTimeout(() => leaf.remove(), 15000);
    }
    setInterval(createLeaf, 2000);

    // Logic for Inputs
    const pInput = document.getElementById('partner-input');
    const pDisplay = document.getElementById('partner-name-display');
    const lArea = document.getElementById('letter-content');
    let currentLeafSlot = null;

    pInput.addEventListener('input', (e) => {
      const val = e.target.value || "Love";
      pDisplay.textContent = val;
      if(window.elementSdk) window.elementSdk.setConfig({partner_name: val});
    });

    lArea.addEventListener('input', (e) => {
      if(window.elementSdk) window.elementSdk.setConfig({letter_content: e.target.value});
    });

    function triggerPhoto(id) {
      currentLeafSlot = id;
      document.getElementById('photo-input').click();
    }

    function handleFile(e) {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        const el = document.getElementById(`leaf-${currentLeafSlot}`);
        el.innerHTML = `<img src="${event.target.result}" class="w-full h-full object-cover">`;
      };
      reader.readAsDataURL(file);
    }

    // Scratch Logic
    function initScratch() {
      const canvas = document.getElementById('scratch-canvas');
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#7D8B6F';
      ctx.fillRect(0, 0, 320, 180);
      
      ctx.font = '20px Cormorant Garamond';
      ctx.fillStyle = '#FDF8F3';
      ctx.textAlign = 'center';
      ctx.fillText('Scratch to Reveal', 160, 95);

      let isDrawing = false;
      const scratch = (e) => {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        ctx.globalCompositeOperation = 'destination-out';
        ctx.beginPath();
        ctx.arc(x, y, 25, 0, Math.PI * 2);
        ctx.fill();
      };

      canvas.addEventListener('mousedown', () => isDrawing = true);
      canvas.addEventListener('touchstart', () => isDrawing = true);
      window.addEventListener('mouseup', () => isDrawing = false);
      window.addEventListener('touchend', () => isDrawing = false);
      canvas.addEventListener('mousemove', scratch);
      canvas.addEventListener('touchmove', (e) => { e.preventDefault(); scratch(e); }, {passive: false});
    }

    function onConfigChange(cfg) {
      pDisplay.textContent = cfg.partner_name || "Love";
      pInput.value = cfg.partner_name || "";
      lArea.value = cfg.letter_content || defaultConfig.letter_content;
      document.getElementById('fortune-text').textContent = cfg.fortune || defaultConfig.fortune;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToEditPanelValues: (cfg) => new Map([
            ["partner_name", cfg.partner_name],
            ["letter_content", cfg.letter_content],
            ["fortune", cfg.fortune]
        ])
      });
    }

    initScratch();
    onConfigChange(defaultConfig);
  </script>
 </body>
</html>
